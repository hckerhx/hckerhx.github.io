<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>策略实验室 - 下跌监控</title>
    <!-- Handwritten Font -->
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>

<body class="js-loading">
    <div class="language-switcher">
        <button class="lang-button active" data-lang="zh">中文</button>
        <button class="lang-button" data-lang="en">EN</button>
    </div>

    <nav class="site-nav">
        <div class="nav-container">
            <a class="nav-link" id="navMonitor" href="index.html">下跌监控</a>
            <a class="nav-link" id="navTheory" href="theory.html">策略理论</a>
        </div>
    </nav>

    <div class="container app-container">
        <!-- Main Monitor Panel -->
        <main class="application-panel">
            <header class="panel-header">
                <h1 class="panel-title" id="panelTitle">下跌监控</h1>
                <p class="panel-locale" id="heroSubtitle">简单直观的策略辅助工具</p>
            </header>

            <!-- Ticker Input Area -->
            <section class="ticker-board">
                <div class="input-wrapper">
                    <input type="text" id="newTickerInput" class="ticker-input-large" placeholder="输入代码 (如 AAPL)"
                        autocomplete="off">
                </div>

                <div class="ticker-history" id="tickerList">
                    <!-- Historical tags will be injected here via JS -->
                    <!-- Example: <span class="history-tag">AAPL <span class="remove-btn">x</span></span> -->
                </div>
                <p style="margin-top:1rem; font-size:0.9rem; opacity:0.6;" id="tickerExample">支持美股与港股</p>
            </section>

            <!-- Status Message -->
            <div class="status-banner" id="statusBanner"></div>

            <!-- Chart & Results Area -->
            <section class="chart-area">
                <div class="chart-card">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                        <h3 id="chartTitle">价格走势</h3>
                        <div id="chartSubtitle" style="font-size:0.8rem; opacity:0.7"></div>
                    </div>

                    <div class="chart-body">
                        <canvas id="priceChart"></canvas>
                        <div class="chart-placeholder" id="chartPlaceholder">输入代码查看走势</div>
                    </div>
                </div>

                <!-- Hidden / Simplified Results container for data storage/logic compatibility -->
                <div id="resultsContainer" class="results-container hidden"></div>
            </section>

            <!-- Settings Toggle -->
            <div class="adv-settings-toggle" id="toggleSettings">显示更多设置</div>

            <!-- Collapsible Settings Panel -->
            <div class="settings-panel" id="settingsPanel">
                <div class="control-group">
                    <label id="observationTitle">观测时间 (月)</label>
                    <input type="number" id="observationMonths" min="1" max="12" value="2">
                </div>
                <div class="control-group">
                    <label id="thresholdTitle">买入阈值 (%)</label>
                    <input type="number" id="dropThreshold" min="5" max="80" value="20">
                </div>
                <div class="control-group">
                    <label id="emailLabel">提醒邮箱</label>
                    <input type="email" id="alertEmail" placeholder="you@example.com" style="width:200px;">
                </div>
                <div style="text-align:center; margin-top:1rem;">
                    <button class="button" id="savePreferences">保存设置</button>
                    <button class="button secondary" id="refreshAll">刷新数据</button>
                </div>

                <hr style="margin:1rem 0; border:none; border-top:1px dashed #ccc;">

                <!-- Advanced EmailJS keys (hidden or minimized) -->
                <details>
                    <summary style="cursor:pointer; opacity:0.6;">API Keys</summary>
                    <div class="control-group" style="margin-top:0.5rem;">
                        <input type="text" id="serviceId" placeholder="Service ID">
                        <input type="text" id="templateId" placeholder="Template ID">
                        <input type="text" id="publicKey" placeholder="Public Key">
                    </div>
                </details>
            </div>

        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <p id="footerNote">Invest at your own risk. Not financial advice.</p>
        </div>
    </footer>

    <!-- Minimal script to handle the toggle view, rest handled by tracker.js -->
    <script>
        document.getElementById('toggleSettings').addEventListener('click', function () {
            document.getElementById('settingsPanel').classList.toggle('open');
            this.textContent = document.getElementById('settingsPanel').classList.contains('open')
                ? '隐藏设置'
                : '显示更多设置';
        });
    </script>
    <script src="js/tracker.js"></script>
</body>

</html>